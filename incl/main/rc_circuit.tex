\chapter{RC Circuits}
\section{RC Circuits}
An RC circuit is an electrical circuit consisting of resistors and capacitors. In its simplest form, it is composed of one of each. In that case, a charged capacitor placed in series with a resistor will discharge back through the resistor \cite[p~21]{artof}. 

\begin{figure}[H]
 \input{fig/tikz/rc}
 \caption{An RC circuit with a battery, a capacitor and a resistor}
\end{figure}

\noindent If both sides of \eqref{QCV} are differentiated  with respect to $t$:
\begin{align}
	\frac{dq}{dt} &= C \cdot \frac{dv}{dt} 
\end{align}
From \eqref{I=dq/dt}, the left-hand side can be rewritten as:
\begin{align}
	I_C = C \cdot \frac{dv}{dt}\label{I_C}
\end{align}
\subsection{Transient Analysis}
\label{sec371}
To find out how the voltage of a capacitor changes over time when it is charged and discharged, transient analysis is used.
\\
\\
\textbf{Charging of a Capacitor}\\
KCL states that the sum of the currents in a node is equal to zero. In the case of an RC circuit, the law can be written as the following equation:
\begin{align}
I_{C}+I_{R}&=0 \nonumber \\
I_{C}&= -I_{R} \label{Ic-Ir}
\end{align}
Inserting the definition of the current through the capacitor \eqref{I_C} and the resistor \eqref{Ohm} into \eqref{Ic-Ir}, yields a differential equation, which can then be separated as stated in section \ref{SepDiff}:
\begin{align*}
C \dfrac{dv}{dt}&=\dfrac{-V}{R} \\
\dfrac{dv}{dt} &= -V\dfrac{1}{RC} \\
\frac{1}{V}dv &= \frac{-1}{RC}dt
\end{align*}
The equation is now in the same form as \eqref{SDEG}, and can be solved as following:
\begin{align}
\int \dfrac{1}{V}dv =& \dfrac{-1}{RC} \int dt\nonumber \\
\ln(V) =& \dfrac{-t}{RC} + A \nonumber\\
V =& e^{\frac{-t}{RC}}e^{A}\label{V_eA}
\end{align}
Since $A$ is the constant of integration, $e^A$ is a constant aswell.
\\
By definition, the starting voltage of the capacitor is given by $V_C(t=0)=V_0$:
 \begin{align*}
	V_C(0) &= e^{\frac{0}{RC}}e^A\\
	V_C(0) &= e^A
 \end{align*}
Therefore $e^A = V_0$, and this can be inserted into \eqref{V_eA}:
\begin{align}
\label{V_down}
\Aboxed{
 V(t) = V_0e^{\frac{-t}{RC}}
 }
\end{align}
The function in \eqref{V_down} describes how the voltage decreases over time, when the capacitor is discharged.
\\
\\
\textbf{Discharging of a Capacitor}\\
KVL states that the sum of the voltages over a loop must be equal to zero. 
\\
In an RC circuit with a battery this can be written algebraic as:
\begin{align}
V_B-V_R-V_C =& 0 \nonumber \\
V_B=&V_R+V_C \label{V_B}
\end{align}
$V_R$ and $V_C$ have negative signs, since their elements create a negative potential difference when charge passes through them.
\\
From \eqref{Ohm}, the voltage drop across the resistor can be expressed as $V_R=IR$. From \eqref{QCV} the voltage drop across the capacitor can be expressed as $V_C=\dfrac{Q}{C}$. This is inserted into \eqref{V_B}:
\begin{align}
V_B =& IR+\dfrac{Q}{C} \label{Vb=IR}
\end{align}
As stated in \eqref{I=dq/dt}, current is defined as $I =\dfrac{dq}{dt}$, and this is inserted into \eqref{Vb=IR}.
 \begin{align*}
 	V_B &= \frac{dq}{dt} R + \frac{Q}{C}
 \end{align*}
Both sides are divided by $R$:
\begin{align}
\dfrac{V_B}{R} &= \dfrac{dq}{dt} + Q\dfrac{1}{RC}\label{Vb/R} 
\end{align}
This is now a linear differential equation of the first order in the form of \eqref{FODE_form}:
\begin{align*}
\dfrac{dy}{dx}+h(x)y=g(x)
\end{align*}
If the conditions for the general solution for a linear differential equation of the first order are fulfilled, \eqref{Vb/R} can be solved like in (REF til linear eq)

\begin{align*}
\dfrac{dy}{dx}&=\dfrac{dq}{dt}
\\
h(x)&=\dfrac{1}{RC}
\\
H(x)&=\int \dfrac{1}{RC}=\dfrac{t}{RC}
\\
y &= Q
\\
g(x)&= \dfrac{V_B}{R}
\end{align*}
This is inserted in the general solution \eqref{FODE_solution}:
\begin{align}
Q&= e^{\frac{-t}{RC}}\int_{0}^{t}e^{\frac{t}{RC}}\dfrac{V_B}{R}dt
\\
Q&= e^{\frac{-t}{RC}}\dfrac{V_B}{R}\int_{0}^{t}e^{\frac{t}{RC}}dt \label{Q_1}
\end{align}
The integral is now solved by substitution. First $u$ and $\dfrac{du}{dt}$ are defined:
\begin{align*}
u &= \dfrac{t}{RC}
\\
\dfrac{du}{dt}&=\dfrac{1}{RC}
\\
dt &=RC du
\end{align*} 
By inserting these definitions into \eqref{Q_1} the equation looks like this:
\begin{align*}
Q&=e^{\frac{-t}{RC}}\dfrac{V_B}{R}\int_{0}^{\frac{t}{RC}}RCe^u du
\\
Q&=e^{\frac{-t}{RC}} V_B C [e^u]_{0}^{\frac{t}{RC}}
\\
Q&=V_B C e^{\frac{-t}{RC}}(e^{\frac{t}{RC}}-1)
\\
Q&=V_B C (1-e^{\frac{-t}{RC}})
\end{align*} 
The voltage of a capacitor is given as $V_C=\dfrac{Q}{C}$. By dividing the equation above with $C$, the function for charging a capacitor is found.
\begin{align}
\label{V_up}
\Aboxed{
V_C(t)=V_B(1-e^{\frac{-t}{RC}})
}
\end{align}
\section{RC circuit experiment}
In the following section an RC circuit experiment has been made. Data from an RC circuit will be compared to values from a mathematical model.
\subsection{Theoretical Values}
The resistor and capacitor in the experiment, had the following values:
\begin{align*}
 R =& 4770\Omega \\
 C =& 97.61nF
\end{align*}
The circuit was set up as follows:
\begin{figure}[H]
	\input{fig/tikz/excircuit.tex}
	\caption{A circuit with a resistor(4770$\Omega$) and a capacitor(97.61nF)}
\end{figure}
\noindent The time constant $\tau$, is defined as $\tau = RC$. In this case $\tau$ is:
\begin{align*}
	\tau = 4.77 k\Omega \cdot 97.61 nF &= 46.56 \cdot 10^{-5} s \\
\end{align*}
Furthermore, the charging and discharging of the capacitor can then be put in a table. Since the formula $V_{charge}(t)=V_B(1-e^{\frac{-t}{RC}})$ contains $e^{\frac{-t}{RC}}$, the table values can be calculated for different $\tau$ values. Hereby a table can be created for $V_{charge}$ and $V_{discharge}$:
\begin{table}[H]
\center
\begin{tabular}{|l|l|l|}
\hline
$\tau$ & $V_{charge}$ & $V_{discharge}$ \\ \hline
1      & 63.2\%       & 36.8\%         \\ \hline
2      & 86.5\%       & 13.5\%         \\ \hline
3      & 95.0\%       & 5.0\%          \\ \hline
4      & 98.2\%       & 1.8\%          \\ \hline
5      & 99.3\%       & 0.7\%          \\ \hline
\end{tabular}
\caption{$\tau$ charge and discharge percentages}
\end{table}
\noindent Generally, the capacitor is considered fully charged, or discharged, at $5\tau$. \\
The time it takes for the capacitor to be fully charged, or discharged, is in this case:
\begin{align*}
5\tau &= 5 \cdot 46.56 \cdot 10^{-5} s \\
&= 2.33 ms
\end{align*}
\subsection{Test Values Comparison}
\begin{figure}[H]
	\center
		\includegraphics[clip, trim=0cm 18cm 0cm 0cm, scale=0.5]{fig/img/test_circuit_1}
	\caption{RC circuit}
	\label{rc_flow}
\end{figure}
% Vær OBS på farvebeskrivelser af ledninger
This section uses the Analog Discovery 2 for setting up an RC circuit. The first step of the set-up is inserting a positive waveform generator (yellow) and a positive scope (blue) showing the waveforms. The waveform generator uses an AC step voltage. The current then passes through a resistor ($4.77 k\Omega$) and a capacitor ($97.61 nF$). Another scope is inserted to measure the charging and discharging of the capacitor. First, the current passes through a positive scope (orange), then the capacitor, and back through a negative scope (orange/white). Hypothetically, if the two scopes were switched, it would be measuring the inverse charging and discharging. Lastly, the current passes through a negative scope (blue/white) and into a negative waveform generator (yellow/white). Hereby, the circuit illustrated in figure \ref{rc_flow} is created with the same values as in the previous section. \\ \\
To get the test values compatible with the theoretical values, the frequency input has to be calculated as the hertz needed for the capacitor to charge and discharge. Therefore, the wave generator has to produce $214.6 Hz$  ($(2 \cdot 2.33 ms)^{-1} = 214.6 Hz$). \\
The data from the theoretical values and the test results can now be compared using python:
\begin{figure}[H]
\center
\includegraphics[scale=0.6]{fig/img/eks_1}
\caption{Capacitor charge and discharge}
\end{figure}
\noindent As shown on the graph, the test results are very close to the calculated theoretical values. $R^2$ is almost equal to 1, which means that the two plots are almost identical.
